# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Firebase Hosting on PR
'on': pull_request
jobs:
  build_and_preview:
    runs-on: ubuntu-latest
   steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - name: Checkout Repo
        uses: actions/checkout@v2
      - name: Setup node
        uses: actions/setup-node@master
        with:
          node-version: "12.16.1"
      # Install the dependencies need to build the app
      - name: Install Dependencies
        run: npm ci
      # Run lint
      - name: Run Lint
        run: npm run lint
      # Run tests
      - name: Run Tests
        run: npm run test
      # Runs a set of commands to build
      - name: Build
        run: npm run build --prod
      - uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: "${{ secrets.GITHUB_TOKEN }}"
          firebaseServiceAccount: "${{ secrets.FIREBASE_SERVICE_ACCOUNT_BORACODAR_F03DD }}"
          channelId: live
          projectId: boracodar-f03dd
        env:
          FIREBASE_CLI_PREVIEWS: hostingchannels
      # Send mail with status
      - name: Send mail
        if: always()
        uses: dawidd6/action-send-mail@v2
        with:
          # mail server settings
          server_address: smtp.gmail.com
          server_port: 465
          # user credentials
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          # email subject
          subject: ${{ job.status }} => Deploy /bora.codar (CMS)
          # email body as text
          body: ${{ github.workflow }} of ${{ github.repository }} has ${{ job.status }}. https://boracodar-f03dd.web.app
          # comma-separated string, send email to
          to: rntd3signer@gmail.com,brunocustodiodev@gmail.com, bacustodio@hotmail.com
          # from email name
          from: Deploy bora.codar

